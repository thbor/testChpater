<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>ç« èŠ‚</title>
    <script type="text/javascript" src="./js/jquery-3.4.1.min.js"></script>
</head>
<body class="contenttext">

  <div class="main" id="main">
    <div class="main2">
      <div class="inner">
        <!--booksæ˜¯å¾ˆå¤šå€‹oneBook   oneBookæ˜¯ä¸€æœ¬æ›¸çš„æ¨£å­-->
        <div id="chapterContent">
          <h1 class="center">ç¬¬ä¸€ç« </h1>
         ã€Šçº¢æ¥¼æ¢¦ã€‹åœ¨ä¸­å›½å°è¯´è‰ºæœ¯å‘å±•å²ä¸Šï¼Œæ—¢ç»“æŸäº†ä¸€ä¸ªæ—¶ä»£ï¼Œ
         ä¹Ÿå¼€åˆ›äº†ä¸€ä¸ªæ—¶ä»£ã€‚å®ƒçš„ä½œè€…æ›¹é›ªèŠ¹æ¯”æ‰˜å°”æ–¯æ³°ã€å·´å°”æ‰å…‹ã€
         ç‹„æ›´æ–¯ç­‰ä¸–ç•Œæ€§çš„è‰ºæœ¯å·¨æ“˜è¦æ—©ä¸€ä¸ªä¸–çºªï¼Œå°±ç™»ä¸Šäº†å…¨çƒæ–‡å­¦çš„é«˜å³°ã€‚
         <p style="color: aquamarine;">åŒæ—¶ï¼Œã€Šçº¢æ¥¼æ¢¦ã€‹è¿˜æ˜¯ä¸æ•´ä¸ªä¸­å›½æ°‘æ—æ–‡åŒ–ç´§ç´§è”ç³»åœ¨ä¸€èµ·çš„ï¼Œ</p>
         äººä»¬ä¸€æèµ·ã€Šçº¢æ¥¼æ¢¦ã€‹å°±è‡ªç„¶æƒ³åˆ°äº†ä¸­å›½æ°‘æ—æ–‡åŒ–ï¼Œè€Œä¸€æèµ·ä¸­å›½æ°‘æ—æ–‡åŒ–ï¼Œ
         å°±è‡ªç„¶æƒ³åˆ°äº†ã€Šçº¢æ¥¼æ¢¦ã€‹ã€‚ç„¶è€Œï¼ŒæŠŠæˆ‘å›½å¤ä»£å°è¯´å‘å±•æ¨å‘é¡¶å³°çš„æ›¹é›ªèŠ¹ï¼Œ
         åœ¨å…¶ç”Ÿå‰ä¸èº«åå¹¶ä¸æ˜¯éƒ½è·å¾—äººä»¬åº”æœ‰çš„è®¤è¯†ï¼Œå°½ç®¡ä»–çš„ã€Šçº¢æ¥¼æ¢¦ã€‹ä»ä¸€é—®ä¸–å°±å—åˆ°äº†è¯»è€…çš„å–œçˆ±ï¼Œ
         ä»¥é«˜ä»·äº‰è´­è¿™éƒ¨ä»¤äººå…¥è¿·çš„å°è¯´ï¼Œè¾¾åˆ°äº†â€œå¼€è°ˆä¸è¯´ã€Šçº¢æ¥¼æ¢¦ã€‹ï¼Œè¯»å°½è¯—ä¹¦æ˜¯æ‰ç„¶â€ï¼ˆã€Šäº¬éƒ½ç«¹æè¯ã€‹ï¼‰çš„ç¨‹åº¦ï¼Œ
         <p>ä½†æœ‰å…³ä½œè€…çš„çœŸå®æƒ…å†µå´å¾ˆå°‘æœ‰äººè®°è¿°ã€‚ç›´åˆ°æœ¬ä¸–çºª20å¹´ä»£åˆï¼Œèƒ¡é€‚è€ƒè®¢ã€Šçº¢æ¥¼æ¢¦ã€‹çš„ä½œè€…ä¸ºæ›¹é›ªèŠ¹ï¼Œåˆ
         ç»è¿‡åŠä¸ªå¤šä¸–çºªå­¦è€…ä»¬çš„è€ƒç´¢ï¼Œæ‰ä½¿æˆ‘ä»¬å¯¹ã€Šçº¢æ¥¼æ¢¦ã€‹ä½œè€…æœ‰äº†ä¸€äº›å¹¶ä¸è¯¦å°½çš„äº†è§£ã€‚æ›¹é›ªèŠ¹åéœ‘ï¼Œå­—æ¢¦é˜®ï¼Œ</p>
         å·é›ªèŠ¹ï¼Œåˆå·èŠ¹åœƒã€èŠ¹æºªï¼Œç”Ÿäºæ¸…ä»£åº·ç†™æœ«å¹´ï¼ˆ1715?ï¼‰ã€‚å…ˆä¸–åŸæ˜¯æ±‰æ—ï¼Œå¤§çº¦åœ¨æ˜ä»£åæœŸè¢«ç¼–å…¥æ»¡æ´²æ­£ç™½æ——ï¼Œ
         èº«åˆ†æ˜¯â€œåŒ…è¡£â€ã€‚è¿™ç§â€œåŒ…è¡£â€çš„å®¶åº­ï¼Œå¯¹çš‡å¸ï¼Œä»–ä»¬æ˜¯å¥´æ‰ï¼›è€Œè®ºå…¶åœ°ä½ï¼Œåˆ™åˆå±è´µæ—ã€‚æ›¹é›ªèŠ¹çš„æ›¾ç¥–æ›¹çºä»»æ±Ÿå®ç»‡é€ ï¼Œ
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         æ›¾ç¥–æ¯å­™æ°æ˜¯åº·ç†™çš„è¤“æ¯ï¼Œç¥–çˆ¶æ›¹å¯…åšè¿‡åº·ç†™çš„ä¼´è¯»å’Œå¾¡å‰ä¾å«ï¼Œåä»»
         
        </div>
        <div id="showBjDiv" style="display: none;" ></div>
          
          <div class="center">
            <button class="layui-btn layui-btn-radius layui-btn-warm" onclick="preChapter()">ä¸Šä¸€ç« </button>
            <button class="layui-btn layui-btn-radius layui-btn-warm" onclick="toBook()">è¿”å›ä¹¦ç±</button>
            <button class="layui-btn layui-btn-radius layui-btn-warm" onclick="nextChapter()">ä¸‹ä¸€ç« </button>
          </div>

      </div>
        <!-- contenteditable="true" -->
  
    </div>
  </div>
   
      
    <div style="visibility: hidden;" id="contentId" onclick="clickContent()">
      è¿™æ˜¯ä¸€æ¡å°å°çš„è¯„è®º
    </div>




  </div>

  </body>
<script>
      $(function() {
        init();
        t();
        notesShow()
        // t2();
      });
      function clickContent(){
        alert("ä¸è¦ä¼¤å®³æˆ‘")
      }
      function notesShow(){
        $('.contenttext').mouseover(function(){
          $('.noteClass').mouseover(function(){
            console.log("in")
            let dom = document.getElementById("contentId")
            dom.style.visibility = ""
            let position = getMousePos();
            let left = position.x;
            let top = position.y;
            dom.style.position="relative";
            dom.style.top=top+"px";
            dom.style.left = left+"px";
            dom.style.color="white"
            dom.style.background="#2F4F4F"
            console.log("position",position)
          })
          $('.noteClass').mouseout(function(){
            console.log("out")
            // document.getElementById("contentId").style.visibility = "hidden"
            
          })
         
      })

      }
      function getMousePos(event) {
        var e = event || window.event;
        return {'x':e.clientX,'y':e.clientY}
      }
      function init(){
        returnZindex();
        // getInitMarkLocation()
        
      }
      function returnZindex(){
        let dom = document.getElementById("main")
        dom.style.zIndex = 0;
      }
      function t(){
        $('.contenttext').mouseup(function(){
          console.log("mouseover")
          // SetToBold();
          var range = window.getSelection().getRangeAt(0);
          var container = range.startContainer;
          var txt = window.getSelection?window.getSelection():document.selection.createRange().text;
          if(txt){
            let w = window.getSelection();
          const start = {
            node: range.startContainer,
            offset: range.startOffset
          };
          const end = {
            node: range.endContainer,
            offset: range.endOffset
          };
          CssTxt(txt,start.offset,end.offset);
          let length = end.offset-start.offset
          var rect = range.getBoundingClientRect();
          var x = rect.left, y = rect.top;var height = rect.height;var top = rect.top;
          let x1 = (rect.left+rect.width)/2
          //y1ä¸æ˜¯ä¸€è¡Œçš„è¯è¦å‡æ‰ä¸€ä¸ªè¡Œé«˜
          let y1 = (rect.top+rect.y)
          console.log(rect)
          if(length!=0){
            showBj(rect,length,txt,range);
          }else{
            hiddenBj();
          }
          }
         
      })
      
      }
      function CssTxt(txt,start,end){
        let allTxt = txt.anchorNode.wholeText;
        //åˆ†å‰²æˆæ•°ç»„ï¼Œåé¢å¯ä»¥æ ¹æ®å¼€å§‹å’Œç»“æŸçš„ä½ç½®å¾—åˆ°æ•°æ®
        allTxt = allTxt.split('');
        var chooseArr = [];
        var chooseTxt = [];
        for(let i=start;i<end;i++){
          chooseArr.push(allTxt[i]);
        }
        chooseTxt = chooseArr.join('')
      }
      function mouseupBj(){

      }
      function hiddenBj(){
        document.getElementById("showBjDiv").style.display = "none"
      }
      function showBj(rect,length,txt,range){
        let x = rect.left;
        // let y = (rect.top+rect.y)
        let top = rect.top;
        let height = rect.height;
        let nHtml = "";
        //top-height/å‡ è¡Œ
        //ä¸€è¡Œ20 æ¯å¢åŠ ä¸€è¡Œå¢åŠ 40px
        let heightNum = (height+20)/40
        //191ä¸ºyç¬¬ä¸€è¡Œçš„èµ·å§‹ä½ç½®
        let y = rect.y
        // let y=top-height/heightNum;
        // let y = rect.height*heightNum;
        console.log(x,y)
        nHtml+='<div id="showBjDiv" class="showBjDiv" style="position:fixed;left:'+x+"px"+';top:'+y+"px"+'">'
        nHtml+='<span onclick=addBj() class="span-bj" id="addNodes">åšç¬”è®°</span>'
        nHtml+= '<span  class="span-bj" id="mark">é©¬å…‹ç¬”ğŸ–Š</span>';
        nHtml+='</div>'
        $("#showBjDiv").html(nHtml)
        document.getElementById("showBjDiv").style.display = ""
        document.getElementById("mark").addEventListener("click", function(){ 
          clickMark(range)
      });
      document.getElementById("addNodes").addEventListener("click", function(){ 
          addNodes(range)
      });
      }
      function addBj(){
        console.log("æ·»åŠ ç¬”è®°")
        
        hiddenBj();
      }
      // function getInitMarkLocation(){
      //   let start = 2;
      //   let end = 10;
      //   var range = document.createRange();
      //   let p1 = document.getElementById("chapterContent")
      //   console.log("childNodes",p1.childNodes)
      //   // var helloNode = p1.firstChild;
      //   // var worldNode = p1.lastChild;
      //   for(let item of p1.childNodes){
          
      //   }
      //   var startNode = p1.childNodes[2];
      //   var endNode = p1.childNodes[3];
      //   range.setStart(startNode,10)
      //   range.setEnd(endNode,1)
      //   console.log(worldNode)
      //   clickMark(range)
        
      // }
      // function getInitMarkLocation(){
      //   let start = 2;
      //   let end = 10;
      //   var range = document.createRange();
      //   let p1 = document.getElementById("chapterContent")
      //   console.log("childNodes",p1.childNodes)
      //   // var helloNode = p1.firstChild;
      //   // var worldNode = p1.lastChild;
      //   for(let item of p1.childNodes){
          
      //   }
      //   var helloNode = p1.childNodes[2];
      //   var worldNode = p1.childNodes[3];
      //   range.setStart(helloNode,10)
      //   range.setEnd(worldNode,0)
      //   clickMark(range)
        
      // }
      //  function getInitMarkLocation(){
      //   let start = 2;
      //   let end = 5;
      //   var p1Index = -1;
      //   var i, len;
      //   var range = document.createRange();
      //   // var range2 = document.createRange();
      //   //  let nodes = document.querySelectorAll("p")[1]
      //   let dom = document.getElementById("chapterContent")
      //   let startNode  = document.querySelectorAll("p")[1]
      //   var startOffset = start;
      //   range.setStart(startNode,startOffset)
      //   // var range = window.getSelection();
      //   console.log("range",range)
      //   range2 = range.selectAllChildren()
        
      //   // let nodes = document.querySelectorAll("p")[1]
      //   // let nodes = document.getElementById("chapterContent")
      //   // // const nodes = getSelectedNodes(range, range2);
      //   // nodes.forEach(node => {
      //   // const wrap = document.createElement('span');
      //   // wrap.setAttribute('class', 'mark-class');
      //   // wrap.appendChild(node.cloneNode(false));
      //   // node.parentNode.replaceChild(wrap);
      //   // });
        
      // }
      //çµ¦pæ¨™ç±¤æ·»åŠ 

      // function getInitMarkLocation(){
      //   let start = 2;
      //   let end = 10;
        
      //   var range = document.createRange();
      //   let dom = document.getElementById("chapterContent")
      //   console.log("childNode",dom.childNodes)
      //   //æ›¿æ›æ¨™ç±¤
      //   $("p:eq(0)").replaceWith('<a style="color:red">æ›¿æ¢ç¬¬äºŒæ®µçš„å†…å®¹</a>')
      //   let domHtml = dom.innerHTML;
      //   console.log(dom.innerHTML)
      //   let span = document.createElement('span')
      //   span.className = 'mark-class'
      //   span.innerHTML = domHtml;
      //   // dom.insertNode(span)
      //   // dom.insertBefore(span,dom.childNodes[3]);//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ’å…¥çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åœ¨å“ªä¸ªå…ƒç´ ä¹‹å‰æ’å…¥
      //   // dom.appendChild(span);
      //   // dom.innerHTML()
      //   // dom.className = 'mark-class'
      //   // range.selectNode(dom)
        
      // }
      // function getInitMarkLocation(){
      //   let start = 2;
      //   let end = 10;
      //   // var tagString = "<div>I am a div node</div>";
      //   var range = document.createRange();
      //   // span.className='mark-class'
      //   let dom = document.getElementById("chapterContent")
      //   dom.className = 'mark-class'
      //   // range.selectNode(document.getElementsByTagName("div").item(0));
      //   range.selectNode(dom)
      //   // var documentFragment = range.createContextualFragment(tagString);

      //   // document.body.appendChild(documentFragment);
      //   // var myDiv = document.getElementById("chapterContent");
      //   // var textNode = myDiv.firstChild;
      //   // var rangeObj = document.createRange();
      //   // rangeObj.setStart(textNode,2);
      //   // rangeObj.setEnd(textNode,10);
      //   // clickMark(rangeObj)
      //   // rangeObj.addClass();
      // //   var div = document.getElementById("chapterContent");
      // //   var rangeObj = document.createRange();
      // //   rangeObj.selectNodeContents(div);
      // //   var documentFragment = rangeObj.cloneContents();
      // //   div.appendChild(documentFragment);
      // }
      var content = "æˆ‘æ˜¯ä¸€æ¡å°å°çš„è¯„è®º"
      function moveContent() {
        var srcDiv = document.getElementById("srcDiv");
        var destDiv = document.getElementById("destDiv");
        var rangeObj = document.createRange();
        rangeObj.selectNodeContents(srcDiv);
        var documentFragment = rangeObj.extractContents();
        destDiv.appendChild(documentFragment);
    }
     function clickMark(range){
        var selectionContents = range.extractContents();
        var span = document.createElement("span");
        span.className='mark-class'
        span.appendChild(selectionContents);
        range.insertNode(span);
        hiddenBj();
        
        let allhtml = $('#chapterContent').html()
        console.log("allHtml",allhtml)
     }
     function addNodes(range){
        var selectionContents = range.extractContents();
        var span = document.createElement("span");
        span.className='noteClass'
        span.appendChild(selectionContents);
        range.insertNode(span);
        hiddenBj();
        
        let allhtml = $('#chapterContent').html()
        // console.log("allHtml",allhtml)
     }
     function SetToBold () {
          var range = window.getSelection().getRangeAt(0);
          var selectionContents = range.extractContents();
          var span = document.createElement("span");
          // span.className='mark-class'
          span.appendChild(selectionContents);
          range.insertNode(span);
      }
      function preChapter(){
        alert("preChapter")
      }
      function nextChapter(){
        alert("nextChapter")
      }
      function toBook(){
        alert("toBook")
      }
      
     
   
     
    
</script>
<style>
  .showBjDiv{
    color: aliceblue;
    background-color: rgb(247, 118, 33);
    width: 160px;
    margin-right: 40px;
    text-align: center;
    opacity:0.8;
    line-height:30px;
    font-size: 15px;
    border-radius: 10px;
  }
  .span-bj{
    margin-left: 10px;
    cursor: pointer;
  }
  ::selection {
    background:rgb(214, 105, 132); 
    color:white;
}

.mark-class {
  /* background-image: url("image\\underline.png"); */
  color: red;
  background-repeat:repeat-x;
  background-size:9px 4px;
  padding-bottom:3px;
  background-position:0 100%;
}
.span-bj:hover{
  color: blue;
}
.contenttext{
  line-height: 40px;
  font-size: 18px;
}
.main{
  position:absolute;
  top: 60px;
  width: 96%;
  margin-left: 2%;
  height: 80%;
  z-index: -1;
  
}
.main2{
  top: 80px;
  position:absolute;
  border: 1px solid #dde0e4;
  overflow-y: auto;
  overflow-x: hidden;
}
.inner{
  height: 100%;
  width: 100%;
}
.noteClass{
  background: blueviolet;
}
.noteClass:hover{
  color: aquamarine;
}
.hidden{
  display: none;
}
.show{
  display: "";
}

</style>
</html>